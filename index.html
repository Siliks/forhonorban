<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>For Honor – Online Pick & Ban</title>

<style>
body { margin: 0; font-family: Arial, Helvetica, sans-serif; background: #0f172a; color: #e5e7eb; }
header { padding: 20px; text-align: center; background: #020617; border-bottom: 2px solid #1e293b; }
h1 { margin: 0; font-size: 2rem; }
.container { padding: 20px; max-width: 1200px; margin: auto; }
.room { text-align: center; margin-bottom: 20px; }
input { padding: 8px; border-radius: 6px; border: none; margin-right: 8px; }
button { padding: 10px 14px; border-radius: 8px; border: none; cursor: pointer; margin-top: 5px; transition: background 0.3s, color 0.3s; }
button:hover { opacity: 0.9; }
#resetBtn { background: #1d4ed8; color: white; }
#resetBtn.defenderClicked { background: #3b82f6; color: white; }
#resetBtn.attackerClicked { background: #ef4444; color: white; }
#resetBtn.bothClicked { background: #16a34a; color: white; }
#resetIndicator { text-align: center; font-weight: bold; margin-top: 5px; }
.phase { text-align: center; margin-bottom: 20px; font-size: 1.3rem; font-weight: bold; color: #93c5fd; }
.heroes { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 15px; }
.hero { background: #020617; border: 2px solid #1e293b; padding: 12px; text-align: center; cursor: pointer; border-radius: 10px; user-select: none; transition: transform 0.15s, border-color 0.15s; }
.hero:hover { transform: scale(1.05); border-color: #60a5fa; }
.summary { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 30px; }
.box { background: #020617; border: 2px solid #1e293b; border-radius: 12px; padding: 15px; }
.box h2 { margin-top: 0; text-align: center; color: #93c5fd; }
ul { list-style: none; padding: 0; margin: 0; }
li { padding: 6px 0; border-bottom: 1px solid #1e293b; text-align: center; }
.defender-ban { color: #60a5fa; }
.attacker-ban { color: #ef4444; }
.hero.banned.defender { background-color: #1e40af; border-color: #60a5fa; color: #93c5fd; cursor: not-allowed; }
.hero.banned.attacker { background-color: #991b1b; border-color: #ef4444; color: #fecaca; cursor: not-allowed; }

/* Glow animation for reset button */
@keyframes glow {
  0% { box-shadow: 0 0 0px #fff; }
  50% { box-shadow: 0 0 15px #facc15; }
  100% { box-shadow: 0 0 0px #fff; }
}
button.glow { animation: glow 0.8s ease-in-out; }
</style>
</head>
<body>

<header>
<h1>For Honor – Online Pick & Ban</h1>
</header>

<div class="container">
<div class="room">
  <input id="roomId" placeholder="Room code" />
  <button onclick="joinRoom()">Join / Create Room</button>
  <button id="resetBtn" onclick="requestReset()">Reset Bans</button>
</div>

<div id="playerIndicator" class="phase"></div>
<div id="phase" class="phase">Enter a room code</div>
<div id="resetIndicator"></div>

<div class="heroes" id="heroes"></div>

<div class="summary">
  <div class="box">
    <h2>Defender Bans</h2>
    <ul id="p1"></ul>
  </div>
  <div class="box">
    <h2>Attacker Bans</h2>
    <ul id="p2"></ul>
  </div>
</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getDatabase, ref, set, onValue, update, runTransaction, get } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyBeS-SDFEkQ-eh8EeqvI0qK2so020ddfA",
  authDomain: "forhonorban.firebaseapp.com",
  databaseURL: "https://forhonorban-default-rtdb.firebaseio.com",
  projectId: "forhonorban",
  storageBucket: "forhonorban.appspot.com",
  messagingSenderId: "878364292748",
  appId: "1:878364292748:web:ab3bd412f2368a0dc22da9"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const heroes = [
  "Warden","Peacekeeper","Centurion","Black Prior","Conqueror","Lawbringer","Gladiator","Warmonger",
  "Raider","Berserker","Highlander","Jormungandr","Valkyrie","Warlord","Shaman",
  "Kensei","Orochi","Shugoki","Nobushi","Shinobi","Aramusha","Hitokiri","Kyoshin",
  "Tiandi","Jiang Jun","Nuxia","Shaolin","Pirate","Medjay","Afeera","Ocelotl"
];

const heroDiv = document.getElementById("heroes");
const phaseText = document.getElementById("phase");
const p1List = document.getElementById("p1");
const p2List = document.getElementById("p2");
const playerIndicator = document.getElementById("playerIndicator");
const resetBtn = document.getElementById("resetBtn");
const resetIndicator = document.getElementById("resetIndicator");

let room = null;
let player = null;
let sessionId = localStorage.getItem("sessionId");
if (!sessionId) { sessionId = Math.random().toString(36).substring(2,10); localStorage.setItem("sessionId", sessionId); }

window.joinRoom = async () => {
  room = document.getElementById("roomId").value.trim();
  if (!room) return alert("Enter a room code");

  const roomRef = ref(db, `rooms/${room}`);
  const snap = await get(roomRef);
  let data = snap.val();

  if (!data) {
    await set(roomRef, { phase: "defender", p1: [], p2: [], players: { [sessionId]: "defender" }, resetRequests: {} });
    player = "defender";
    data = { phase: "defender", p1: [], p2: [], players: { [sessionId]: "defender" }, resetRequests: {} };
  } else {
    if (!data.players) data.players = {};
    if (!data.resetRequests) data.resetRequests = {};
    if (!data.players[sessionId]) {
      if (!Object.values(data.players).includes("defender")) data.players[sessionId] = "defender";
      else if (!Object.values(data.players).includes("attacker")) data.players[sessionId] = "attacker";
      else return alert("Room is full!");
      await update(roomRef, { players: data.players });
    }
    player = data.players[sessionId];
    if (!data.p1) data.p1 = [];
    if (!data.p2) data.p2 = [];
  }

  onValue(roomRef, snap => {
    const newData = snap.val();
    if (!newData.p1) newData.p1 = [];
    if (!newData.p2) newData.p2 = [];
    if (!newData.resetRequests) newData.resetRequests = {};
    if (!newData.players) newData.players = {};
    render(newData);
  });

  render(data);
};

function render(data) {
  playerIndicator.textContent = player ? `You are ${player.toUpperCase()}` : "";

  p1List.innerHTML = (data.p1 || []).map(h => `<li class="defender-ban">${h}</li>`).join("");
  p2List.innerHTML = (data.p2 || []).map(h => `<li class="attacker-ban">${h}</li>`).join("");

  if (data.phase === "defender") phaseText.textContent = "Defender banning";
  else if (data.phase === "attacker") phaseText.textContent = "Attacker banning";
  else if (data.phase === "complete") phaseText.textContent = "Round complete - click Reset to start next round";

  heroDiv.innerHTML = "";
  heroes.forEach(hero => {
    const d = document.createElement("div");
    d.className = "hero";
    d.textContent = hero;
    if ((data.p1 || []).includes(hero)) d.classList.add("banned","defender");
    else if ((data.p2 || []).includes(hero)) d.classList.add("banned","attacker");
    d.onclick = () => banHero(hero,data);
    heroDiv.appendChild(d);
  });

  const resetRequests = data.resetRequests || {};
  const clickedPlayers = Object.keys(resetRequests).filter(id => resetRequests[id]).map(id => data.players[id] || "Unknown");
  resetIndicator.textContent = clickedPlayers.length ? `Reset clicked by: ${clickedPlayers.join(", ")}` : "";
  resetBtn.classList.remove("defenderClicked","attackerClicked","bothClicked");
  if (clickedPlayers.length === 1) resetBtn.classList.add(clickedPlayers[0] === "defender" ? "defenderClicked":"attackerClicked");
  else if (clickedPlayers.length >= 2) resetBtn.classList.add("bothClicked");
}

function banHero(hero,data){
  if (data.phase === "complete") return;
  if ((data.p1||[]).includes(hero) || (data.p2||[]).includes(hero)) return;
  if (data.phase !== player) return alert("Not your turn");

  const updates = {};
  if(player==="defender"&&(data.p1||[]).length<2){
    updates.p1=[...(data.p1||[]),hero];
    if(updates.p1.length===2) updates.phase="attacker";
  }
  if(player==="attacker"&&(data.p2||[]).length<2){
    updates.p2=[...(data.p2||[]),hero];
    if(updates.p2.length===2) updates.phase="complete"; // lock
  }
  update(ref(db,`rooms/${room}`),updates);
}

// Reset button with glow
async function requestReset(){
  if(!room||!player) return alert("Join a room first");
  const roomRef = ref(db,`rooms/${room}`);
  runTransaction(roomRef,data=>{
    if(!data) return data;
    data.p1=[];
    data.p2=[];
    data.phase="defender"; // reset phase
    data.resetRequests={};
    if(!data.players) data.players={};
    data.players[sessionId]=player;
    return {...data};
  }).then(()=>{
    resetBtn.classList.add("glow");
    setTimeout(()=>resetBtn.classList.remove("glow"),800);
  });
}
</script>

</body>
</html>
