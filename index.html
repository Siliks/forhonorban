<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>For Honor – Online Pick & Ban</title>

<style>
body{margin:0;font-family:Arial;background:#0f172a;color:#e5e7eb}
header{padding:20px;text-align:center;background:#020617;border-bottom:2px solid #1e293b}
.container{padding:20px;max-width:1200px;margin:auto}
.room{text-align:center;margin-bottom:20px}
input{padding:8px;border-radius:6px;border:none}
button{padding:10px 14px;border-radius:8px;border:none;cursor:pointer;margin:6px}
.phase{text-align:center;margin:12px;font-size:1.2rem;color:#93c5fd}
.heroes{display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:12px}
.hero{background:#020617;border:2px solid #1e293b;padding:10px;text-align:center;border-radius:10px;cursor:pointer}
.hero.banned.defender{background:#1e40af;border-color:#60a5fa;cursor:not-allowed}
.hero.banned.attacker{background:#991b1b;border-color:#ef4444;cursor:not-allowed}
.summary{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-top:20px}
.box{background:#020617;border:2px solid #1e293b;border-radius:12px;padding:12px}
ul{list-style:none;padding:0;margin:0}
li{text-align:center;padding:4px}
#newRound{text-align:center;margin-top:15px}
</style>
</head>
<body>

<header><h1>For Honor – Online Pick & Ban</h1></header>

<div class="container">
  <div class="room">
    <input id="roomId" placeholder="Room code">
    <button onclick="joinRoom()">Join / Create</button>
  </div>

  <div id="playerTag" class="phase"></div>
  <div id="phase" class="phase">Enter a room</div>

  <div id="heroes" class="heroes"></div>

  <div class="summary">
    <div class="box"><h3>Defender Bans</h3><ul id="p1"></ul></div>
    <div class="box"><h3>Attacker Bans</h3><ul id="p2"></ul></div>
  </div>

  <div id="newRound"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getDatabase, ref, onValue, get, set, update } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

const firebaseConfig={
  apiKey:"AIzaSyBeS-SDFEkQ-eh8EeqvI0qK2so020ddfA",
  authDomain:"forhonorban.firebaseapp.com",
  databaseURL:"https://forhonorban-default-rtdb.firebaseio.com",
  projectId:"forhonorban",
  storageBucket:"forhonorban.appspot.com",
  messagingSenderId:"878364292748",
  appId:"1:878364292748:web:ab3bd412f2368a0dc22da9"
};

const app=initializeApp(firebaseConfig);
const db=getDatabase(app);

const HEROES=[
"Warden","Peacekeeper","Centurion","Black Prior","Conqueror","Lawbringer","Gladiator","Warmonger",
"Raider","Berserker","Highlander","Jormungandr","Valkyrie","Warlord","Shaman",
"Kensei","Orochi","Shugoki","Nobushi","Shinobi","Aramusha","Hitokiri","Kyoshin"
];

const el={
  heroes:document.getElementById("heroes"),
  phase:document.getElementById("phase"),
  p1:document.getElementById("p1"),
  p2:document.getElementById("p2"),
  tag:document.getElementById("playerTag"),
  newRound:document.getElementById("newRound")
};

let room=null;
let role=null;
let sid=localStorage.getItem("sid")||Math.random().toString(36).slice(2,10);
localStorage.setItem("sid",sid);

window.joinRoom=async()=>{
  room=document.getElementById("roomId").value.trim();
  if(!room) return alert("Enter room code");

  const r=ref(db,"rooms/"+room);
  const snap=await get(r);
  let d=snap.val();

  if(!d){
    d={phase:"defender",p1:[],p2:[],players:{[sid]:"defender"}};
    await set(r,d);
  }else{
    d.players=d.players||{};
    if(!d.players[sid]){
      if(!Object.values(d.players).includes("defender")) d.players[sid]="defender";
      else if(!Object.values(d.players).includes("attacker")) d.players[sid]="attacker";
      else return alert("Room full");
      await update(r,{players:d.players});
    }
  }

  role=d.players[sid];
  el.tag.textContent="You are "+role.toUpperCase();

  onValue(r,s=>render(s.val()));
};

function render(d){
  if(!d) return;
  el.p1.innerHTML=d.p1.map(h=>`<li>${h}</li>`).join("");
  el.p2.innerHTML=d.p2.map(h=>`<li>${h}</li>`).join("");

  el.phase.textContent=
    d.phase==="defender"?"Defender banning":
    d.phase==="attacker"?"Attacker banning":
    "Round complete";

  el.heroes.innerHTML="";
  HEROES.forEach(h=>{
    const div=document.createElement("div");
    div.className="hero";
    div.textContent=h;
    if(d.p1.includes(h)) div.classList.add("banned","defender");
    if(d.p2.includes(h)) div.classList.add("banned","attacker");
    div.onclick=()=>ban(h,d);
    el.heroes.appendChild(div);
  });

  el.newRound.innerHTML=d.phase==="complete"
    ? `<button onclick="resetRound()">Start New Round</button>`
    : "";
}

function ban(hero,d){
  if(d.p1.includes(hero)||d.p2.includes(hero)) return;
  if(d.phase!==role) return;

  if(role==="defender" && d.p1.length<2){
    update(ref(db,"rooms/"+room),{
      p1:[...d.p1,hero],
      phase:d.p1.length===1?"attacker":"defender"
    });
  }
  if(role==="attacker" && d.p2.length<2){
    update(ref(db,"rooms/"+room),{
      p2:[...d.p2,hero],
      phase:d.p2.length===1?"complete":"attacker"
    });
  }
}

window.resetRound=()=>{
  update(ref(db,"rooms/"+room),{
    p1:[],
    p2:[],
    phase:"defender"
  });
};
</script>
</body>
</html>
